---
layout: post
category : blog
title: "我的测试之路（二）--白银时代"
tags : [blog, test]
---

手动测试需要花很多的时间和人力，导致项目的开发进度受限制。所以几乎所有的公司都会有自动化测试的需求，自动化测试是趋势。
自动化测试被大量的用在回归测试，性能测试中，我从工作的第三年正式开始接触自动化测试，从此似乎又进入了另一个世界，我把它叫做“白银时代”

## 自动化测试

也许很多人对自动化测试的认识起始于著名的软件`QTP`, 就是通过录制回放脚本来达到自动化测试的目的
很不幸我刚认识自动化测试的时候也是这样，当时想象着自己平时的一些测试可以用这样简单的方式来实现，像Magic一样
之后开始明白自动化测试的概念远远的大于`QTP`这类软件所能涵盖的内容。

## UI自动化困境

公司当时的项目是基于 `TestComplete`, 软件本身简单容易掌握，基于软件建立起相应的框架，
建立脚本的规范，编写了一系列的脚本而且建立了报告系统去监控每次脚本运行情况，似乎一切都很顺利。

然后正式在项目中运行起来之后，噩梦开始了

+ 对运行环境的要求比较苛刻，（系统，屏幕分辨率等）每次运行需要初始化华景
+ UI层变动频繁，脚本大批量失败，维护花的时间比写脚本的时间长的多的多
+ 脚本结果验证对UI变化的敏感性，很多不是问题的问题导致脚本失败
+ 简单的脚本通过率还可以，但步骤比较多的脚本很容易失败也难于修改
+ 基础的控件识别率还可以，但项目中自定义的控件基本都需要大量额外的工作才能支持
+ 项目变大之后，性能开始大幅下降

那时候想的一些办法

+ 使用虚拟机保证环境，使用初始化脚本保证其他运行设置
+ 结构化脚本， 将基础模块提炼出来作为函数库，缩减每个脚本的行数
+ 多使用XML，和属性的比较，摈弃基于图片的比较方式
+ 把基础功能用软件稳定的API来实现，验证部分用UI自动化

但维护的成本依旧很高，投入回报比太低

## 分层的自动化测试

后来泡论坛的时候看到网上有人在提出分层的自动化测试，把测试尽量往拉向底层，后来在一次培训中听一个老师讲了Google内部的分层自动化才恍然大悟
插一句，Google是我入测试行业以来最期待的一家公司，他里面的测试理念，工程师文化都是我所向往的。

Google内部把自动化测试分散在三层，维持`1:2:7`的比例，实现一个稳定的金字塔结构，而金字塔的顶端则是`手动测试`和`探索式测试`已达到资源的最大使用效率。

+ `UI层` ：10%
+ `接口层`： 20% 
+ `Unit Test`： 70% 

把自动化测试放在底层，放在更不容易有频繁变动的地方，给自动化提供了一个稳定运行并发挥作用的环境  
同时稳定的自动化又可以给项目的改动提供一层保护网，及时的去发现项目改动导致的问题

> TDD中的单元测试就是这样的例子
> 测试驱动开发的比喻。开发可以从两个方面去看待：实现的功能和质量。测试驱动开发更像两顶帽子思考法的开发方式，
> 先戴上实现功能的帽子，在测试的辅助下，快速实现正确的功能；再戴上重构的帽子，在测试的保护下，通过去除冗余和
> 重复的代码，提高代码重用性，实现对质量的改进。可见测试在测试驱动开发中确实属于核心地位，贯穿了开发的始终。


质量不是测出来的，是开发写出来的，所以通过测试来提高开发的代码质量才是最本质的解决软件质量问题的方法
也就是很多人会提到的`内部质量`与`外部质量`

+ 外部质量： 包括功能测试，界面测试，可用性测试，大部分是用户可见的，也是传统的测试关注比较多的
+ 内部质量： 包括单元测试，接口测试，用户故事测试，大部分是用户不可见，但用于支持整个团队的

![](http://spaces8.qiniudn.com/agile-4.jpg)

许多自动化测试的不成功大多是因为多关注外部质量而忽略内部质量
试想一下，面对一个千疮百孔的软件，再强大的UI自动化也不能让他的质量变好。
而好的软件架构设计，稳定的接口，全面的单元测试覆盖将会提供一个软件高质量的基础

所以Google内部把测试叫做开发测试工程师，测试所在部门叫生产力部门（Productivity）
所以一个好的质量文化是多么的重要，下一篇会写一些这方面的


## 测试的自动化

知道了`自动化测试`，那么什么是`测试的自动化`呢? 

可以想象自动化测试并不能覆盖测试的所有，其实有许多测试数据获得，整理，分析，测试结果汇总等等都可以用自动化的方式来实现
有的地方叫做半自动化技术，有的地方叫测试的自动化

如测试中脚本的大量使用，为测试提供了很多便利，提高了效率， 比如

+ `Diff 技术`，是说对两个相近版本做输出结果的对比来发现其中变化的部分，从而缩小测试的范围将重心放在变化的部分上
  而这种Diff可以是文件的对比，可以是图片的比较，数据量很大但效率可以很高


## 其他用到的一些技术

+ `Code Coverage`: 公司曾经采用过发布基于Code Coverage的版本，QA基于之上测试，
  而测试覆盖的模块范围以及代码覆盖率可以作为下一步测试的参考， 如没有测到的
  模块或逻辑通过和开发交流去设计相应的测试用例, 从而形成一个测试的闭环系统
  
+ `CER`: 软件最严重的问题是Crash，但往往难于重现，而项目发布之后用户是否遇到类似问题也不知道。
   该项目建立了一套针对Crash问题收集相应数据的框架以使得开发容易重现和修复相应问题，如果类似问题出现次数多
   则严重性会更高
   
+ `iMark`, 基于每个版本有专门的性能测试用例，分析各个模块各个功能所用时间，以使得性能的衰退及早被发现

## 总结

+ 尽量把测试（或自动化测试）推向底层，以保证自动化测试的质量与效率，产生高的回报
+ 自动化技术没有好坏之分，找到合适的场景去使用相应的技术才是正确的方式